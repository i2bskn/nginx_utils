#!/usr/bin/env ruby
# coding: utf-8

require "optparse"

begin
  require "nginx_utils"
rescue LoadError => e
  puts e
  exit 1
end

# Option parse
options = {}

opt = OptionParser.new
Version = "0.0.1"
opt.on("--only-value", "The output only the value.") {|v| options[:only_value] = v}

opt.parse! ARGV

if ARGV.size > 0
  host = ARGV.shift
  result = NginxUtils::Status.get host: host
else
  result = NginxUtils::Status.get
end

if options[:only_value]
  puts result.values.join("\t")
else
  puts "Active Connections: #{result[:active_connection]}"
  puts "Accepts: #{result[:accepts]} Handled: #{result[:handled]} Requests: #{result[:requests]}"
  puts "Reading: #{result[:reading]} Writing: #{result[:writing]} Waiting: #{result[:waiting]}"
end
